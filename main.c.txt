#include <stdio.h>
#include "pcb.h"

/* Scheduler functions */
void fcfs();
void sjf();
void round_robin(int quantum);
void priority_scheduling();

/* Memory functions */
void init_memory();
void first_fit(PCB *p);
void deallocate_memory(int pid);
void display_memory();

PCB process_table[MAX_PROCESSES];
int process_count = 3;

void print_process_table() {
    printf("\nPID AT BT PR MEM WT TAT STATE\n");
    for(int i = 0; i < process_count; i++) {
        printf("%2d  %2d %2d %2d %3d %2d  %2d  %s\n",
            process_table[i].pid,
            process_table[i].arrival_time,
            process_table[i].burst_time,
            process_table[i].priority,
            process_table[i].memory_required,
            process_table[i].waiting_time,
            process_table[i].turnaround_time,
            state_name(process_table[i].state));
    }
}

int main() {

    process_table[0] = (PCB){1,0,5,2,10,0,0,NEW};
    process_table[1] = (PCB){2,1,3,1,15,0,0,NEW};
    process_table[2] = (PCB){3,2,4,3,20,0,0,NEW};

    print_process_table();

    printf("\n=== FCFS ===\n");
    fcfs();
    print_process_table();

    printf("\n=== SJF ===\n");
    sjf();
    print_process_table();

    printf("\n=== Round Robin (Q=2) ===\n");
    round_robin(2);
    print_process_table();

    printf("\n=== Priority Scheduling ===\n");
    priority_scheduling();
    print_process_table();

    printf("\n=== Memory Allocation (First Fit) ===\n");
    init_memory();
    for(int i = 0; i < process_count; i++) {
        first_fit(&process_table[i]);
        display_memory();
    }

    printf("\n=== Memory Deallocation ===\n");
    for(int i = 0; i < process_count; i++) {
        deallocate_memory(process_table[i].pid);
        display_memory();
    }

    return 0;
}
