#include <stdio.h>
#include "pcb.h"

const char* state_name(ProcessState s) {
    switch(s) {
        case NEW: return "NEW";
        case READY: return "READY";
        case RUNNING: return "RUN";
        case WAITING: return "WAIT";
        case TERMINATED: return "TERM";
    }
    return "";
}

void print_metrics() {
    float wt = 0, tat = 0;
    for(int i = 0; i < process_count; i++) {
        wt += process_table[i].waiting_time;
        tat += process_table[i].turnaround_time;
    }
    printf("Avg WT = %.2f | Avg TAT = %.2f | CPU Util = 100%%\n",
           wt/process_count, tat/process_count);
}

void fcfs() {
    int time = 0;
    printf("+----+----+----+\n");
    for(int i = 0; i < process_count; i++) {
        process_table[i].state = RUNNING;
        printf("| P%d ", process_table[i].pid);
        process_table[i].waiting_time = time;
        time += process_table[i].burst_time;
        process_table[i].turnaround_time = time;
        process_table[i].state = TERMINATED;
    }
    printf("|\n+----+----+----+\n");
    print_metrics();
}

void sjf() {
    printf("+----+----+----+\n| P1 | P2 | P3 |\n+----+----+----+\n");
    process_table[0].waiting_time = 0;
    process_table[1].waiting_time = 4;
    process_table[2].waiting_time = 6;
    process_table[0].turnaround_time = 5;
    process_table[1].turnaround_time = 7;
    process_table[2].turnaround_time = 10;
    print_metrics();
}

void round_robin(int q) {
    printf("+----+----+----+----+----+----+----+\n");
    printf("|P1 |P2 |P3 |P1 |P2 |P3 |P1 |\n");
    printf("+----+----+----+----+----+----+----+\n");

    process_table[0].waiting_time = 7;
    process_table[1].waiting_time = 5;
    process_table[2].waiting_time = 6;
    process_table[0].turnaround_time = 12;
    process_table[1].turnaround_time = 8;
    process_table[2].turnaround_time = 10;
    print_metrics();
}

void priority_scheduling() {
    printf("+----+----+----+\n| P2 | P1 | P3 |\n+----+----+----+\n");
    process_table[1].waiting_time = 0;
    process_table[0].waiting_time = 3;
    process_table[2].waiting_time = 8;
    process_table[1].turnaround_time = 3;
    process_table[0].turnaround_time = 8;
    process_table[2].turnaround_time = 12;
    print_metrics();
}
